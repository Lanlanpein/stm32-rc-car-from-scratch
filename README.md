# STM32 WiFi Remote Control Car (STM32 WiFi 遥控小车)

本项目是一个基于 **STM32F103** 单片机的 WiFi 遥控小车底层驱动程序。通过 UART 串口接收 WiFi 模块传来的指令，利用 L298N 驱动直流电机，实现小车的前进、后退、转向及多模式速度控制。

## 📖 项目简介 (Introduction)

该项目使用 STM32 标准外设库开发。系统通过串口 (USART2) 接收手机 APP发送的 ASCII 字符指令，解析后控制 PWM 占空比和 GPIO 电平，从而驱动 L298N 模块控制电机转速与方向。

主要特性包括：

* **多模式控制**：支持线性加速 (Low)、爆发加速 (High) 和定速巡航 (Constant) 三种模式。
* **PWM 调速**：使用 TIM2 产生 PWM 波平滑控制车速。
* **差速转向**：通过调整左右轮速度差实现平滑转向。
* **双向通信**：基于 UART 的透传控制（波特率 9600）。

## 🛠️ 硬件环境 (Hardware Requirements)

* **主控芯片**：STM32F103系列 (如 STM32F103C8T6)
* **电机驱动**：L298N 模块
* **通信模块**：WiFi 模块 (如 ESP8266/ESP-01S，配置为串口透传模式)
* **执行器**：直流减速电机 x2 (或 x4 并联)
* **电源**：12V/7.4V 锂电池组

## 🔌 引脚定义 (Pin Definitions)

| 模块 | 功能 | STM32 引脚 | 描述 |
| --- | --- | --- | --- |
| **L298N** | 左轮逻辑 A | GPIOB Pin 6 | 方向控制 |
|  | 左轮逻辑 B | GPIOB Pin 7 | 方向控制 |
|  | 右轮逻辑 A | GPIOA Pin 6 | 方向控制 |
|  | 右轮逻辑 B | GPIOA Pin 7 | 方向控制 |
|  | 左轮使能 (EN) | GPIOA Pin 0 | TIM2_CH1 (PWM 调速) |
|  | 右轮使能 (EN) | GPIOA Pin 1 | TIM2_CH2 (PWM 调速) |
| **WiFi** | USART TX | GPIOA Pin 2 | 接 WiFi 模块的 RX |
|  | USART RX | GPIOA Pin 3 | 接 WiFi 模块的 TX |
| **其他** | 按键 (备用) | GPIOB Pin 15 | 预留按键输入 |

## 🎮 控制协议 (Control Protocol)

小车通过串口接收单字符指令，波特率 **9600**。

### 1. 模式切换指令

发送以下字符切换驾驶模式：

* **`L`**: **线性模式 (Linear Mode)** - 默认模式。按键微调速度 (+/- 5)，适合精准控制。
* **`H`**: **高速模式 (High Mode)** - 爆发模式。前进指令会大幅增加速度 (+50)，停止时归零。
* **`C`**: **定速模式 (Constant Mode)** - 按下按键即设定为固定速度 (如 50)，松开或转向时设定为预设差速。

### 2. 运动控制指令 (WASD)

根据当前模式不同，行为略有差异，基本逻辑如下：

| 指令字符 | 动作 | 逻辑描述 |
| --- | --- | --- |
| **`W`** | 前进 | 增加左右轮速度 (正向) |
| **`S`** | 后退 | 减少左右轮速度 (反向) |
| **`A`** | 左转 | 减左轮速，加右轮速 (差速转向) |
| **`D`** | 右转 | 加左轮速，减右轮速 (差速转向) |
| **`F`** | 停止 | 强制速度归零 |
| **`N`** | 停止 | 强制速度归零 (仅 C 模式) |

## 📂 文件结构 (File Structure)

* `main.c`: 主循环，处理串口接收到的数据并执行状态机逻辑。
* `Motor.c/h`: 电机 GPIO 初始化、正反转逻辑及速度限幅 (`Limit`) 函数。
* `PWM.c/h`: 定时器 TIM2 初始化及 PWM 占空比设置。
* `WiFi.c/h`: USART2 串口初始化及数据接收函数。
* `Key.c/h`: 板载按键驱动 (当前版本主要作为预留接口)。

